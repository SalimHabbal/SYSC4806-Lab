<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Address Book</title>
  <!-- Lab6: Enhanced detail view styling and navigation for interactive address book management. -->
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
    .layout { max-width: 760px; margin: 0 auto; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 1.25rem; box-shadow: 0 2px 8px rgba(0,0,0,.05); }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { padding: .6rem .75rem; border-bottom: 1px solid #eee; text-align: left; }
    .empty { color: #666; font-style: italic; }
    .meta { color: #888; font-size: .9rem; margin-bottom: .25rem; }
    .header { display: flex; justify-content: space-between; align-items: baseline; gap: 1rem; }
    .back-link { color: #1f6feb; text-decoration: none; font-weight: 600; }
    .back-link:hover { text-decoration: underline; }
    .section { margin-top: 1.5rem; }
    .alert { padding: .8rem 1rem; border-radius: 8px; margin-top: 1rem; }
    .alert.info { background: #edf2ff; color: #2c5282; border: 1px solid #a3bffa; }
    .alert.success { background: #f0fff4; color: #2f855a; border: 1px solid #9ae6b4; }
    .alert.error { background: #fff5f5; color: #c53030; border: 1px solid #feb2b2; }
    form { margin-top: 1rem; }
    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; align-items: end; }
    label { display: flex; flex-direction: column; font-weight: 600; font-size: .95rem; color: #333; }
    input[type="text"] { margin-top: .35rem; padding: .6rem .65rem; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; }
    button { background-color: #1f6feb; color: #fff; border: none; padding: .7rem 1.4rem; border-radius: 8px; cursor: pointer; font-size: 1rem; }
    button:hover { background-color: #1a5fd0; }
  </style>
</head>
<body>
<div class="layout">
  <div class="card" th:if="${book != null}">
    <div class="header">
      <div>
        <a class="back-link" th:href="@{/addressbooks}">&larr; Back to list</a>
        <div class="meta">AddressBook ID: <span th:text="${book.id}">1</span></div>
      </div>
    </div>

    <!-- Lab6: Display server-driven flash status messages for create/add flows. -->
    <div th:if="${message}" class="alert info" th:text="${message}">Status message.</div>
    <div th:if="${formSuccess}" class="alert success" th:text="${formSuccess}">Buddy added.</div>
    <div th:if="${formError}" class="alert error" th:text="${formError}">Problem adding buddy.</div>

    <h1 class="section">Buddies</h1>
    <table th:if="${#lists.size(book.buddies) > 0}">
      <thead><tr><th>ID</th><th>Name</th><th>Phone</th><th>Address</th></tr></thead>
      <tbody>
      <tr th:each="b : ${book.buddies}">
        <td th:text="${b.id}">1</td>
        <td th:text="${b.name}">Alice</td>
        <td th:text="${b.phone}">555-1111</td>
        <td th:text="${b.address}">100 Main St</td>
      </tr>
      </tbody>
    </table>
    <p class="empty" th:if="${#lists.size(book.buddies) == 0}">No buddies yet.</p>

    <div class="section">
      <h2>Add a Buddy</h2>
      <!-- Lab6: Buddy creation form posts back to the controller to persist entries. -->
      <form th:action="@{/addressbooks/{id}/buddies(id=${book.id})}" method="post">
        <div class="form-grid">
          <label>
            Name
            <input type="text" name="name" placeholder="Jane Doe" required>
          </label>
          <label>
            Phone
            <input type="text" name="phone" placeholder="555-1234" required>
          </label>
          <label>
            Address
            <input type="text" name="address" placeholder="123 Main St">
          </label>
          <div>
            <button type="submit">Add Buddy</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  <div class="card" th:if="${book == null}">
    <h1>Address Book</h1>
    <p class="empty">AddressBook not found.</p>
  </div>
</div>
</body>
</html>
